# Ensemble Analysis

### Requirements

Paciencia++

Pytoch >= 1.7


# Procedure

For ensembling first generate the logits with evaluate. Next, move all the desired logits to a directory 
and pass it through argument to `ensemble.py`.

### ToDo

- SWAG

## Results

Methods:
  - Avg ensemble: Perform an ensemble with original logits and with calibrated logits.
  - Avg ensemble T: Perform an ensemble with original logits and learn a calibration technique
  - Avg ensemble CT: Perform an ensemble with calibrated logits and learn a calibration technique

### CIFAR-10


#### Validation

|    Method       | Accuracy | T.Accuracy |   ECE  |  T.ECE |   MCE  |  T.MCE |  BRIER | T.BRIER |   NNL  |  T.NNL |
|:---------------:|:--------:|:----------:|:------:|:------:|:------:|:------:|:------:|:-------:|:------:|:------:|
|   resnet18      |  0.9580  |   0.9580   | 1.7664 | 0.6921 | 0.8891 | 0.2379 | 0.0066 |  0.0064 | 0.1483 | 0.1407 |
|   resnet18      |  0.9560  |   0.9560   | 2.1937 | 0.9936 | 1.0590 | 0.2206 | 0.0070 |  0.0068 | 0.1594 | 0.1493 |
|   resnet18      |  0.9560  |   0.9560   | 2.1179 | 0.9738 | 1.2142 | 0.3193 | 0.0072 |  0.0070 | 0.1640 | 0.1492 |
|   resnet18      |  0.9554  |   0.9554   | 2.0303 | 0.8682 | 1.0845 | 0.2811 | 0.0071 |  0.0069 | 0.1603 | 0.1508 |
|   resnet18      |  0.9550  |   0.9550   | 2.1711 | 1.1764 | 1.1650 | 0.4497 | 0.0073 |  0.0070 | 0.1638 | 0.1531 |
| Avg ensemble    |  0.9660  |   0.9658   | 0.6835 | 1.4179 | 0.1751 | 0.6765 | 0.0053 |  0.0053 | 0.1080 | 0.1126 |
| Avg ensemble T  |  ------  |   0.9656   | ------ | 0.7155 | ------ | 0.1366 | ------ |  0.0053 | ------ | 0.1105 |
| Avg ensemble CT |  ------  |   0.9652   | ------ | 0.8509 | ------ | 0.1394 | ------ |  0.0053 | ------ | 0.1105 |


|     Method      | Accuracy | T.Accuracy |   ECE  |  T.ECE |   MCE  |  T.MCE |  BRIER | T.BRIER |   NNL  |  T.NNL |
|:---------------:|:--------:|:----------:|:------:|:------:|:------:|:------:|:------:|:-------:|:------:|:------:|
| wresnet28_10    |  0.9636  |   0.9636   | 1.4599 | 0.7719 | 0.8906 | 0.1561 | 0.0059 |  0.0058 | 0.1337 | 0.1272 |
| wresnet28_10    |  0.9648  |   0.9648   | 1.3822 | 0.6609 | 0.6119 | 0.2080 | 0.0057 |  0.0056 | 0.1239 | 0.1196 |
| wresnet28_10    |  0.9646  |   0.9646   | 1.6782 | 0.8738 | 0.6925 | 0.2224 | 0.0057 |  0.0055 | 0.1202 | 0.1149 |
| wresnet28_10    |  0.9640  |   0.9640   | 1.5114 | 0.8737 | 0.5644 | 0.1712 | 0.0057 |  0.0056 | 0.1243 | 0.1198 |
| wresnet28_10    |  0.9654  |   0.9654   | 1.1469 | 0.4461 | 0.5272 | 0.2007 | 0.0057 |  0.0056 | 0.1268 | 0.1237 |
| Avg ensemble    |  0.9700  |   0.9694   | 0.7618 | 0.9937 | 0.1850 | 0.4631 | 0.0045 |  0.0046 | 0.0913 | 0.0948 |
| Avg ensemble T  |  ------  |   0.9694   | ------ | 0.4403 | ------ | 0.1753 | ------ |  0.0046 | ------ | 0.0947 |
| Avg ensemble CT |  ------  |   0.9694   | ------ | 0.5750 | ------ | 0.1714 | ------ |  0.0046 | ------ | 0.0947 |


#### Test

|    Method       | Accuracy | T.Accuracy |   ECE  |  T.ECE |   MCE  |  T.MCE |  BRIER | T.BRIER |   NNL  |  T.NNL |
|:---------------:|:--------:|:----------:|:------:|:------:|:------:|:------:|:------:|:-------:|:------:|:------:|
|   resnet18      |  0.9564  |   0.9564   | 1.8005 | 0.8232 | 0.8705 | 0.2252 | 0.0068 |  0.0066 | 0.1475 | 0.1409 |
|   resnet18      |  0.9552  |   0.9552   | 2.0140 | 0.7748 | 0.9289 | 0.1902 | 0.0070 |  0.0068 | 0.1567 | 0.1483 |
|   resnet18      |  0.9516  |   0.9516   | 2.4544 | 1.0237 | 1.2841 | 0.2751 | 0.0076 |  0.0073 | 0.1670 | 0.1524 |
|   resnet18      |  0.9522  |   0.9522   | 2.1294 | 0.8575 | 1.0734 | 0.2846 | 0.0075 |  0.0072 | 0.1660 | 0.1562 |
|   resnet18      |  0.9510  |   0.9510   | 2.3753 | 0.9601 | 1.0949 | 0.2478 | 0.0078 |  0.0075 | 0.1739 | 0.1624 |
| Avg ensemble    |  0.9635  |   0.9639   | 0.5964 | 1.5580 | 0.1811 | 0.6596 | 0.0053 |  0.0054 | 0.1096 | 0.1149 |
| Avg ensemble T  |  ------  |   0.9640   | ------ | 0.7664 | ------ | 0.1958 | ------ |  0.0053 | ------ | 0.1096 |
| Avg ensemble CT |  ------  |   0.9640   | ------ | 0.7407 | ------ | 0.2077 | ------ |  0.0053 | ------ | 0.1096 |

|     Method      | Accuracy | T.Accuracy |   ECE  |  T.ECE |   MCE  |  T.MCE |  BRIER | T.BRIER |   NNL  |  T.NNL |
|:---------------:|:--------:|:----------:|:------:|:------:|:------:|:------:|:------:|:-------:|:------:|:------:|
| wresnet28_10    |  0.9627  |   0.9627   | 1.3307 | 0.5234 | 0.6253 | 0.1171 | 0.0058 |  0.0057 | 0.1251 | 0.1215 |
| wresnet28_10    |  0.9640  |   0.9640   | 1.1168 | 0.5864 | 0.3270 | 0.1049 | 0.0055 |  0.0054 | 0.1156 | 0.1133 |
| wresnet28_10    |  0.9628  |   0.9628   | 1.2869 | 0.4482 | 0.5294 | 0.1254 | 0.0056 |  0.0055 | 0.1177 | 0.1143 |
| wresnet28_10    |  0.9656  |   0.9656   | 0.9684 | 0.4047 | 0.3356 | 0.1456 | 0.0053 |  0.0052 | 0.1129 | 0.1113 |
| wresnet28_10    |  0.9636  |   0.9636   | 0.9383 | 0.4526 | 0.5028 | 0.0687 | 0.0056 |  0.0055 | 0.1228 | 0.1210 |
| Avg ensemble    |  0.9710  |   0.9710   | 0.6648 | 1.4433 | 0.2068 | 0.4861 | 0.0043 |  0.0044 | 0.0885 | 0.0928 |
| Avg ensemble T  |  ------  |   0.9715   | ------ | 0.4403 | ------ | 0.1162 | ------ |  0.0043 | ------ | 0.0888 |
| Avg ensemble CT |  ------  |   0.9717   | ------ | 0.4675 | ------ | 0.1165 | ------ |  0.0043 | ------ | 0.0887 |


### CIFAR-100

#### Validation


|     Method      | Accuracy | T.Accuracy |   ECE  |  T.ECE |   MCE  |  T.MCE |  BRIER | T.BRIER |   NNL  |  T.NNL |
|:---------------:|:--------:|:----------:|:------:|:------:|:------:|:------:|:------:|:-------:|:------:|:------:|
|    resnet18     |  0.7574  |   0.7574   | 5.0095 | 4.5328 | 1.8547 | 1.6758 | 0.0035 |  0.0035 | 0.9648 | 0.9637 |
|    resnet18     |  0.7762  |   0.7762   | 4.4792 | 4.4686 | 1.5900 | 1.6199 | 0.0032 |  0.0032 | 0.9153 | 0.9153 |
|    resnet18     |  0.7686  |   0.7686   | 4.6993 | 4.8845 | 1.5129 | 1.6702 | 0.0033 |  0.0033 | 0.9366 | 0.9362 |
|    resnet18     |  0.7660  |   0.7660   | 4.9267 | 4.7496 | 2.0477 | 1.7208 | 0.0034 |  0.0034 | 0.9468 | 0.9447 |
|    resnet18     |  0.7660  |   0.7660   | 5.9960 | 4.4861 | 2.2192 | 1.5240 | 0.0034 |  0.0034 | 0.9404 | 0.9307 |
|    Avg ensemble |  0.8030  |   0.8040   | 5.0029 | 5.6589 | 0.6211 | 0.6529 | 0.0028 |  0.0029 | 0.7562 | 0.7617 |
| Avg ensemble T  |  ------  |   0.8024   | ------ | 3.8058 | ------ | 1.7210 | ------ |  0.0028 | ------ | 0.7507 |
| Avg ensemble CT |  ------  |   0.8022   | ------ | 3.7844 | ------ | 1.3407 | ------ |  0.0028 | ------ | 0.7504 |

|      Method     | Accuracy | T.Accuracy |   ECE  |  T.ECE |   MCE  |  T.MCE |  BRIER | T.BRIER |   NNL  |  T.NNL |
|:---------------:|:--------:|:----------:|:------:|:------:|:------:|:------:|:------:|:-------:|:------:|:------:|
|   wresnet28_10  |  0.8076  |   0.8076   | 5.2375 | 4.6481 | 2.5213 | 1.5562 | 0.0029 |  0.0028 | 0.7696 | 0.7591 |
|   wresnet28_10  |  0.8058  |   0.8058   | 4.9362 | 4.0045 | 1.8979 | 1.2335 | 0.0029 |  0.0029 | 0.7641 | 0.7576 |
|   wresnet28_10  |   0.803  |   0.8030   | 4.7467 | 4.4436 | 2.1158 | 1.6936 | 0.0029 |  0.0029 | 0.7866 | 0.7843 |
|   wresnet28_10  |  0.8056  |   0.8056   | 5.9382 | 5.6757 | 1.5039 | 2.0878 | 0.0030 |  0.0029 | 0.8239 | 0.8179 |
|   wresnet28_10  |   0.805  |   0.8050   | 4.7522 | 4.8595 | 1.6118 | 1.8489 | 0.0029 |  0.0029 | 0.7921 | 0.7912 |
|   Avg ensemble  |   0.832  |   0.8324   | 4.0426 | 4.4469 | 0.5341 | 0.5511 | 0.0025 |  0.0025 | 0.6326 | 0.6347 |
| Avg ensemble T  |  ------  |   0.8312   | ------ | 3.6406 | ------ | 1.4949 | ------ |  0.0025 | ------ | 0.6339 |
| Avg ensemble CT |  ------  |   0.8320   | ------ | 3.6419 | ------ | 1.5072 | ------ |  0.0025 | ------ | 0.6354 |

#### Test

|     Method      | Accuracy | T.Accuracy |   ECE  |  T.ECE |   MCE  |  T.MCE |  BRIER | T.BRIER |   NNL  |  T.NNL |
|:---------------:|:--------:|:----------:|:------:|:------:|:------:|:------:|:------:|:-------:|:------:|:------:|
|   resnet18      |  0.7571  |   0.7571   | 4.6541 | 4.5502 | 1.6328 | 1.4557 | 0.0034 |  0.0034 | 0.9571 | 0.9571 |
|   resnet18      |  0.7697  |   0.7697   | 4.7226 | 4.7144 | 1.6386 | 1.6928 | 0.0033 |  0.0033 | 0.9227 | 0.9226 |
|   resnet18      |  0.7622  |   0.7622   | 4.5735 | 4.7826 | 1.5450 | 1.6766 | 0.0034 |  0.0034 | 0.9560 | 0.9561 |
|   resnet18      |  0.7654  |   0.7654   | 4.9192 | 4.1652 | 1.7126 | 1.3871 | 0.0033 |  0.0033 | 0.9271 | 0.9258 |
|   resnet18      |  0.7602  |   0.7602   | 5.6894 | 4.0721 | 1.8701 | 1.1319 | 0.0034 |  0.0034 | 0.9240 | 0.9193 |
|   Avg ensemble  |  0.8009  |   0.8019   | 5.2226 | 5.7798 | 0.6142 | 0.6458 | 0.0028 |  0.0029 | 0.7551 | 0.7611 |
| Avg ensemble T  |  ------  |   0.8038   | ------ | 3.7720 | ------ | 1.3567 | ------ |  0.0028 | ------ | 0.7416 |
| Avg ensemble CT |  ------  |   0.8043   | ------ | 3.7684 | ------ | 1.3407 | ------ |  0.0028 | ------ | 0.7419 |

|      Method     | Accuracy | T.Accuracy |   ECE  |  T.ECE |   MCE  |  T.MCE |  BRIER | T.BRIER |   NNL  |  T.NNL |
|:---------------:|:--------:|:----------:|:------:|:------:|:------:|:------:|:------:|:-------:|:------:|:------:|
|   wresnet28_10  |  0.8076  |   0.8076   | 4.2877 | 2.6976 | 1.6742 | 1.0555 | 0.0028 |  0.0028 | 0.7446 | 0.7391 |
|   wresnet28_10  |  0.7994  |   0.7994   | 4.6489 | 3.3730 | 1.7562 | 1.1220 | 0.0029 |  0.0028 | 0.7623 | 0.7579 |
|   wresnet28_10  |  0.8059  |   0.8059   | 4.5047 | 4.2147 | 1.6693 | 1.4077 | 0.0028 |  0.0028 | 0.7642 | 0.7632 |
|   wresnet28_10  |  0.8075  |   0.8075   | 4.8194 | 4.5525 | 1.0045 | 1.5004 | 0.0028 |  0.0028 | 0.7969 | 0.7849 |
|   wresnet28_10  |  0.8066  |   0.8066   | 3.5695 | 3.6668 | 1.0873 | 1.3088 | 0.0028 |  0.0028 | 0.7662 | 0.7642 |
|   Avg ensemble  |   0.835  |   0.8352   | 4.2427 | 4.6349 | 0.5986 | 0.6204 | 0.0024 |  0.0024 | 0.6241 | 0.6263 |
| Avg ensemble T  |  ------  |   0.8359   | ------ | 2.7199 | ------ | 1.0560 | ------ |  0.0024 | ------ | 0.6135 |
| Avg ensemble CT |  ------  |   0.8361   | ------ | 2.9168 | ------ | 1.0968 | ------ |  0.0024 | ------ | 0.6142 |


### Benchmarks

https://benchmarks.ai/cifar-10
https://benchmarks.ai/cifar-100

### Credits

  - RandAugment Pytorch Implementation: https://github.com/ildoonet/pytorch-randaugment

